<!DOCTYPE html>
  <%- include('./partials/head', {
    title : 'Perfil de usuario'
  }) %> 

<body class="profile">
  <%- include('./partials/header') %> 
  <main class="container">
    <h2 class="mx-4 pt-2">Hola <%= user.name %></h2>
    <nav class="p-4 bg-white">
      <ul class="nav nav-tabs" id="myTab" role="tablist">
        <li class="nav-item" role="presentation">
          <button class="nav-link" onclick="setHash('data')" id="data-tab" data-bs-toggle="tab" data-bs-target="#datosPersonales-tab-pane" type="button" role="tab" aria-controls="datosPersonales-tab-pane" aria-selected="true">Datos personales</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" onclick="setHash('membership')" id="membership-tab" data-bs-toggle="tab" data-bs-target="#membresia-tab-pane" type="button" role="tab" aria-controls="membresia-tab-pane" aria-selected="false">Membresías</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" onclick="setHash('referred')" id="referred-tab" data-bs-toggle="tab" data-bs-target="#referidos-tab-pane" type="button" role="tab" aria-controls="referidos-tab-pane" aria-selected="false">Mis referidos</button>
        </li>
      </ul>
    </nav>
    <div class="tab-content bg-white" id="myTabContent">
      <!-- Datos personales -->
      <section class="tab-pane fade show active profile__mainContainer" id="datosPersonales-tab-pane" role="tabpanel" aria-labelledby="datosPersonales-tap" tabindex="0">
        <div class="container shadow rounded p-5 profile__formContainer">
          <div class="profile__logoContainer">
            <img src="/images/logos/LOGO HQ.png" alt="Logo HQ" class="w-100">
          </div>
          <h3 class="text-center">Modificá tus datos</h3>
          <div class="container">
            <div class="row align-items-center">
              <div class="col-12 col-md-6 p-2">
                <p>Nombre: <%= user.name %></p>
                <p>Apellido: <%= user.surname %></p>
                <p>Fecha de nacimiento: <%= userBirthDay ? userBirthDay : " - " %></p>
                <p>Provincia: <%= user.province ? user.province : " - " %></p>
                <p>Localidad: <%= user.city ? user.city : " - " %></p>
              </div>
              <form action="/usuario/perfil?_method=PUT" method="POST" class="col-12 col-md-6 p-2">
                <div class="col-12">
                  <label for="birthday" class="form-label">Fecha de nacimiento</label>
                  <input type="date" class="form-control" name="birthday" id="birthday" value="">
                  <div class="feedback"></div>
                </div>
                <div class="col-12 mb-3">
                  <label for="provinceSelect" class="form-label">Provincia</label>
                  <select class="form-select" id="provinceSelect" name="province">
                    <option selected hidden>Selecciona tu provincia</option>
                    <% provincias.forEach(provincia => { %>
                      <option value="<%- provincia.nombre %>"><%- provincia.nombre %> </option>
                    <% }) %>
                  </select>
                </div>
                <div class="col-12 mb-3">
                  <label for="citiesSelect" class="form-label">Localidad</label>
                  <select class="form-select" id="citiesSelect" name="city">
                    <option selected>...</option>
                    <option value="1">One</option>
                    <option value="2">Two</option>
                    <option value="3">Three</option>
                  </select>
                </div>
                <div class="col-12 profile__buttonContainer">
                  <button class="button__dark" type="submit">Guardar</button>
                </div>
              </form>
            </div>
          </div>
         
        </div>
      </section>
      <!-- Membresías -->
      <section class="tab-pane fade profile__mainContainer" id="membresia-tab-pane" role="tabpanel" aria-labelledby="membresia-tap" tabindex="1">
        <div class="container">
          <% if (user.membership) { %>
            <h4>Tu membresía activa es: <%= user.membership.name %></h4>
            <p>Vigente hasta: <%= user.expires %></p>
          <% } else { %>
            <h3 class="text-center p-2">Aún no tienes una membresía activa</h3>
            <h4>Elije la que mejor se adapte a ti</h4>
          <% }  %>
          <h5>Tus materias: </h5>
          <ol class="list-group list-group-numbered">
            <li class="list-group-item">Física - UBA - CBC</li>
          </ol>

          <div class="row">
            <% memberships.forEach(membership => { %>
              <div class="col-12 col-md-4 p-3">
                <div class="shadow rounded p-2">
                  <h2 class="text-center"><%- membership.name %> </h2>
                  <p class="text-center">Lorem, ipsum dolor sit amet consectetur adipisicing elit. Rerum eum perferendis animi!</p>
                  <p class="text-center"><strong>$ <%- membership.price %></strong> final x mes</p>
                </div>
              </div>
            <% }) %>
          </div>
        </div>
      </section>
      <!-- Referidos -->
      <section class="tab-pane fade profile__mainContainer" id="referidos-tab-pane" role="tabpanel" aria-labelledby="referidos-tap" tabindex="2">
        <div class="container">
          <div class="row p-3">
            <% if (activeReferredsQuantity === 3) { %>
              <h3>¡Felicitaciones, 3 de tus referidos se registraron en HQ!</h3> 
              <p>Gracias a eso, ganaste una membresía básica gratuita. Activala ahora.</p>
            <% } else { %>
              <p><%= user.name %>, referí hasta 12 personas, si 3 de tus referidos se registran en nuestra plataforma te regalamos 1 membresía básica.</p>
            <% } %>
            <div class="col-12 col-md-4 p-2">
              <h3>Referir</h3>
              <form action="/usuario/referir" method="post" id="referredForm">
                <div class="mb-3">
                  <label for="nameReferred" class="form-label">Nombre*</label>
                  <input type="text" class="form-control" name="name" id="nameReferred" <%= (activeReferredsQuantity === 3) ? "disabled" : "" %> value="<%= locals.old && old.name %>">
                  <small class="text-danger" id="nameReferredError"></small>
                  <% if (locals.errors && errors.name) { %>
                    <small class="text-danger"><%= errors.name.msg %></small>
                  <% } %>
                </div>
                <div class="col-12 mb-3">
                  <label for="emailReferred" class="form-label">Email*</label>
                  <input type="text" class="form-control" name="email" id="emailReferred" <%= (activeReferredsQuantity === 3) ? "disabled" : "" %> value="<%= locals.old && old.email %>">
                  <small class="text-danger" id="emailReferredError"></small>
                  <% if (locals.errors && errors.email) { %>
                    <small class="text-danger"><%= errors.email.msg %></small>
                  <% } %>
                </div>
                <div class="col-12 mb-3 register__buttonContainer">
                  <% if (locals.errors && errors.custom) { %>
                    <small class="text-danger"><%= errors.custom.msg %></small>
                  <% } %>
                  <small class="text-danger" id="submitReferredError"></small>
                  <button class="button__dark" type="submit" <%= (activeReferredsQuantity === 3) ? "disabled" : "" %>>Agregar referido</button>
                </div>
              </form>
            </div>
            <div class="col-12 col-md-8 p-2">
              <h3>Mis Referidos</h3>
              <div class="container">
                <ol class="list-group list-group-numbered row flex-row">
                  <% user.referreds.forEach(referred => { %>
                    <div class="p-2 col-12 col-md-6">
                      <li class="border-bottom p-2  referredContainer">
                        <div>
                          <span class="referredName"><%- referred.name %></span> | <span class="referredEmail"><%- referred.email %></span>
                        </div>
                        <span class="referredActive">
                          <% if (referred.active) { %>
                            <i class="fa-solid fa-check text-success"></i>
                          <% } else {%>
                            <i class="fa-regular fa-clock text-primary"></i> 
                          <% } %>
                        </span>  
                      </li>
                    </div>
                  <% }) %>
                </ol>
              </div>
            </div>
          </div>
        </div>
      </section>
    </div>
  </main>
  <%- include('./partials/footer') %> 
  <%- include('./partials/scripts') %> 
  <script src="/javascripts/Profile/referred.js"></script>
  <script src="/javascripts/Profile/navLinks.js"></script>
  <script src="/javascripts/Profile/personalData.js"></script>
</body>
</html>
